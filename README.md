<<<<<<< Updated upstream
# STRmie

`STRmie` is a Python tool for biological data analysis, organized as a package and supporting modern installation via `pyproject.toml`.

## ✅ Installation (local)

```bash
git clone https://github.com/mazzalab/STRmie.git
cd STRmie
conda env create -f searcHD.yml
conda activate searcHD
pip install -e .
```

## 🚀 Execution
=======
# STRmie-HD

**STRmie-HD** (Short Tandem Repeat Mapping and Identification Engine – Huntington Disease) is an interactive tool designed to support the curation, visualization, and interpretation of short tandem repeat (STR) genotyping data. It enables the refinement and validation of CAG/CCG repeat expansion results, particularly in the context of Huntington-like disorders (HD-like), by highlighting cases of allelic instability or potential misclassification.

## 🚀 Key Features

- Upload Excel-based reports from STR genotyping workflows for sample inspection.
- Compute instability indices such as **Instability Index (II)** and **Expansion Index (EI)** for each sample.
- Visualize CAG/CCG repeat histograms per sample from associated raw `.csv` files.
- Automatically flag samples showing potential Loss (LOI) or Duplication (DOI) of interruption motifs within repeat tracts.
- Manually inspect and correct allele peak values based on histogram evidence.
- Export curated tables for downstream recalculation of instability metrics.

---

## 🛠️ Installation

### 1. Clone the repository

```bash
git clone https://github.com/mazzalab/STRmie-HD.git
cd STRmie-HD
```

### 2. Create and activate the conda environment

```bash
conda env create -f STRmie.yml
conda activate STRmie
```

### 3. Install the package in development mode

```bash
pip install -e .
```

---
>>>>>>> Stashed changes

```bash
strmie
```

or:

```bash
python -m strmie.main
```

<<<<<<< Updated upstream
## 📁 Structure

- `strmie/main.py`: main entry point of the tool  
- `strmie/scripts/`: custom modules and scripts  
- `model_object.pk`: pre-trained model file  
- `searcHD.yml`: Conda environment file (optional, may need updating)  
- `pyproject.toml`: modern package configuration file  
=======
---

## 📊 Graphical User Interface (GUI)

After running the STRmie-HD pipeline, you can launch the integrated graphical interface to visualize and manually inspect the results.

To open the interface locally in your browser:

```bash
strmie
```

or:

```bash
python -m strmie.main
```


## 🧪 Command-line Usage

STRmie-HD provides two main operational modes: **Complete_Pipeline** and **Index_Calculation**.  
The CLI is the primary interface for processing raw input data and computing metrics.

### 🔹 General Syntax

```bash
strmie --mode {Complete_Pipeline,Index_Calculation} -f /path/to/input_dir -o /path/to/output_dir [options]
```

---

### 🔹 1. Complete Pipeline

Runs the full analysis, including histogram peak calling, repeat classification, and optional index calculations.


**Main options:**
- `-f`, `--input` (Required): Directory with `.fastq.gz` raw reads.
- `-o`, `--output` (Required): Directory to save output files.
- `--cutpoint_based`: Use highest peaks on each histogram side.
- `-a`: Set amplitude values for expected peak widths.
- `-i`: Set interval around detected peaks.
- `-ti`: Threshold for Instability Index (recommended: 0.2).
- `-te`: Threshold for Expansion Index (recommended: 0.03).
- `-c`: Cutpoint value to separate alleles (default: 27).
- `-m`: Minimum number of CAG repeats (default: 7).
- `--cag_graph`, `--ccg_graph`: Export CAG/CCG histogram plots.
- `--cwt`: Enable convolutional analysis (optional, advanced).

---

### 🔹 2. Index Calculation Only

Used to recompute instability and expansion indices based on a manually corrected allele table.

```bash
strmie --mode Index_Calculation \
       -f /Users/Alessandro/Desktop/test_starmie/prove_input/ \
       -o /Users/Alessandro/Desktop/test_starmie/prove_output \
       -p /Users/Alessandro/Downloads/CAG_data_for_recalculating_indices.xlsx
```

**Required parameter:**
- `-p`, `--path`: Excel file with 4 columns: `Sample`, `CAG_Allele_1`, `CAG_Allele_2`.

---

For full help:

```bash
strmie --help
```


Once launched:

1. **Upload the Excel report** generated by STRmie-HD.
2. **Select the folder** containing raw count `.csv` files.
3. Click on a sample row to display its **CAG/CCG repeat histogram**.
4. Samples with **LOI_CAA > 10**, **LOI_CCA > 10**, or **DOI > 10** are highlighted to assist in identifying alleles with potential structural interruptions.
5. Modify allele values as needed and **export a corrected Excel table**.


---


---

## 📁 Project Structure

```bash
STRmie-HD/
├── strmie/
│   ├── __init__.py
│   ├── main.py             # Launches the HTML interface
│   ├── scripts/            # Optional analysis helpers
├── STRmie.yml              # Conda environment definition
├── pyproject.toml          # Python packaging config
├── setup.py                # (Optional) traditional setup
├── report.html             # Main interactive HTML interface
```

---

## 📦 Dependencies

Included in the `STRmie.yml` file. Core packages include:

- `pandas`, `numpy`, `openpyxl`, `xlsxwriter`
- JavaScript frontend tools: `Chart.js`, `Bootstrap`, `DataTables`, `XLSX.js`
- No server setup needed – runs entirely in the browser via local file I/O

---

## 📄 License

This project is licensed under the MIT License. See `LICENSE` for details.

---

## 👩‍🔬 Authors

Developed by the [Mazzalab](https://github.com/mazzalab), Italy.  
For questions, please open an issue or contact the maintainers.

---

## 🔗 Citation

If you use STRmie-HD, please cite:

> *[Paper title here]*  
> [Alessandro Napoli, Niccolò Liorni, Tommaso Mazza]  
> *Journal*, [Year], DOI: [insert DOI]


## 📚 Glossary of Terms

- **CAG/CCG repeats**: Trinucleotide repeats found in STR regions of DNA. Expansions in these motifs are implicated in neurodegenerative disorders such as Huntington disease.
- **Allelic peak values**: The modal number of repeats observed for each allele, inferred from the histogram of raw repeat counts.
- **II (Instability Index)**: A measure of somatic instability across a population of repeat lengths within a sample.
- **EI (Expansion Index)**: A metric indicating the bias toward repeat expansions beyond a reference threshold.
- **LOI (Loss of Interruption)**: Indicates the absence of expected CAA or CCA interruptions within CAG/CCG repeat tracts, potentially increasing homogeneity and pathogenicity.
- **DOI (Duplication of Interruption)**: Reflects the presence of additional interruption motifs (e.g., duplicated CAA/CCA sequences) within the STR tract.
>>>>>>> Stashed changes
